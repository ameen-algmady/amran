<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© - Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap&subset=arabic" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background-color: #f5f9ff;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px 0;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .header-btn:hover {
            background: white;
            color: #2a5298;
        }
        
        .grades-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .grade-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }
        
        .grade-section:hover {
            transform: translateY(-3px);
        }
        
        .section-title {
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f5ff;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #2a5298;
        }
        
        .grades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .grade-card {
            background: linear-gradient(135deg, #f8fafd 0%, #f0f5ff 100%);
            border-radius: 10px;
            padding: 20px 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid #e8efff;
            position: relative;
            overflow: hidden;
        }
        
        .grade-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: #2a5298;
            transition: width 0.3s;
        }
        
        .grade-card:hover::before {
            width: 100%;
            opacity: 0.1;
        }
        
        .grade-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(42, 82, 152, 0.15);
            border-color: #2a5298;
        }
        
        .grade-card i {
            font-size: 2.2rem;
            color: #2a5298;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }
        
        .grade-card h3 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }
        
        .grade-card .section {
            font-size: 0.9rem;
            color: white;
            background: #2a5298;
            padding: 4px 12px;
            border-radius: 15px;
            display: inline-block;
            margin-top: 8px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .week-badge {
            background: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-right: 5px;
        }
        
        .homework-table {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
            overflow-x: auto;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .week-info {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
            border-left: 5px solid #4CAF50;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.1);
        }
        
        .week-title {
            color: #1e3c72;
            font-size: 1.6rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .week-dates {
            font-size: 1.2rem;
            color: #2e7d32;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .week-subtitle {
            color: #666;
            font-size: 1rem;
        }
        
        .homework-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .homework-title {
            color: #1e3c72;
            font-size: 1.5rem;
        }
        
        .homework-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .back-btn {
            background: #f0f5ff;
            color: #2a5298;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: #2a5298;
            color: white;
        }
        
        .refresh-btn {
            background: #e8f5e9;
            color: #2e7d32;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            background: #2e7d32;
            color: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        th {
            background-color: #2a5298;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 700;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background-color: #f9fbff;
        }
        
        .day-header {
            background-color: #f0f5ff;
            font-weight: 700;
            color: #1e3c72;
            text-align: right;
            padding: 10px 15px;
            width: 15%;
        }
        
        .subject-item {
            background-color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            text-align: right;
            border-right: 4px solid #2a5298;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .subject-item:hover {
            transform: translateX(-5px);
        }
        
        .subject-name {
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 5px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .homework-text {
            color: #333;
            margin-top: 5px;
            line-height: 1.5;
        }
        
        .no-homework {
            color: #888;
            font-style: italic;
            padding: 20px;
            text-align: center;
            background: #f9f9f9;
            border-radius: 8px;
            border: 2px dashed #ddd;
        }
        
        .current-day {
            background-color: #e8f5e9 !important;
            border-right: 4px solid #4CAF50 !important;
        }
        
        .today-badge {
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-right: 5px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #2a5298;
            font-size: 1.2rem;
        }
        
        .loading i {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .message {
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .data-info {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            text-align: right;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .week-filter-info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
            text-align: right;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .grades-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .homework-table {
                padding: 15px;
            }
            
            .week-info {
                padding: 15px;
            }
            
            .week-title {
                font-size: 1.3rem;
            }
            
            .week-dates {
                font-size: 1rem;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 10px 5px;
            }
            
            .homework-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .homework-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .back-btn, .refresh-btn {
                width: 48%;
                justify-content: center;
            }
            
            .grade-section {
                padding: 15px;
            }
            
            .day-header {
                width: 20%;
            }
            
            .header-buttons {
                width: 100%;
            }
            
            .header-btn {
                flex: 1;
                min-width: 140px;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .grade-card {
                padding: 15px 10px;
            }
            
            .grade-card h3 {
                font-size: 1.1rem;
            }
            
            .subject-item {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .homework-title {
                font-size: 1.3rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1><i class="fas fa-book-open"></i> Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©</h1>
                <p>Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© Ù„Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                <div class="header-buttons">
                    <button class="header-btn" onclick="testConnection()">
                        <i class="fas fa-wifi"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                    </button>
                    <button class="header-btn" onclick="showInstructions()">
                        <i class="fas fa-question-circle"></i> Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
                    </button>
                    <button class="header-btn" onclick="showCurrentWeekInfo()">
                        <i class="fas fa-calendar"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div id="message" class="message"></div>
        
        <div id="grades-container" class="grades-container">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¦Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        
        <div id="homework-container" class="homework-table">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¦Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ...</p>
            <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù</p>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p><i class="fas fa-copyright"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© 2024 - Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©</p>
            <p style="margin-top: 10px; font-size: 0.9rem; color: #888;">
                <i class="fas fa-info-circle"></i> ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google Sheets Ùˆ Google Apps Script
            </p>
            <p style="margin-top: 5px; font-size: 0.8rem; color: #999;">
                Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="last-update">Ø§Ù„ÙŠÙˆÙ…</span>
            </p>
        </div>
    </footer>

    <script>
        // ============================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================
        
        const STUDENT_API_URL = 'https://script.google.com/macros/s/AKfycbz-cl7xGmFvB_1N1wjVplpbHVSxfFWlvfmSO-Afy_7v0jK5dJtsqo-nhDNBGbdiUmCiFw/exec';
        
        // Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ (Ù…Ù† Ø§Ù„Ø³Ø¨Øª Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ ÙÙ‚Ø· - 5 Ø£ÙŠØ§Ù… Ø¯Ø±Ø§Ø³ÙŠØ©)
        const DAYS = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"];
        
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙØµÙˆÙ„ ÙˆØ§Ù„Ø´Ø¹Ø¨
        const SCHOOL_GRADES = [
            {
                title: "Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©",
                icon: "fas fa-child",
                gradeLevel: "primary",
                grades: [
                    { 
                        id: "Ø§Ù„Ø£ÙˆÙ„", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", 
                        sections: ["Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨"],
                        icon: "fas fa-child",
                        color: "#4CAF50"
                    },
                    { 
                        id: "Ø§Ù„Ø«Ø§Ù†ÙŠ", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", 
                        sections: ["Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨"],
                        icon: "fas fa-child",
                        color: "#2196F3"
                    },
                    { 
                        id: "Ø§Ù„Ø«Ø§Ù„Ø«", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", 
                        sections: ["Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨"],
                        icon: "fas fa-child",
                        color: "#FF9800"
                    }
                ]
            },
            {
                title: "Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (4-6)",
                icon: "fas fa-graduation-cap",
                gradeLevel: "intermediate",
                grades: [
                    { 
                        id: "Ø§Ù„Ø±Ø§Ø¨Ø¹", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", 
                        sections: ["Ø£", "Ø¨", "Ø¬"],
                        icon: "fas fa-user-graduate",
                        color: "#9C27B0"
                    },
                    { 
                        id: "Ø§Ù„Ø®Ø§Ù…Ø³", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", 
                        sections: ["Ø£", "Ø¨", "Ø¬"],
                        icon: "fas fa-user-graduate",
                        color: "#3F51B5"
                    },
                    { 
                        id: "Ø§Ù„Ø³Ø§Ø¯Ø³", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", 
                        sections: ["Ø£", "Ø¨", "Ø¬"],
                        icon: "fas fa-user-graduate",
                        color: "#00BCD4"
                    }
                ]
            },
            {
                title: "Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (7-9)",
                icon: "fas fa-graduation-cap",
                gradeLevel: "upper",
                grades: [
                    { 
                        id: "Ø§Ù„Ø³Ø§Ø¨Ø¹", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", 
                        sections: ["Ø£", "Ø¨", "Ø¬"],
                        icon: "fas fa-user-graduate",
                        color: "#FF5722"
                    },
                    { 
                        id: "Ø§Ù„Ø«Ø§Ù…Ù†", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù…Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", 
                        sections: ["Ø£", "Ø¨", "Ø¬"],
                        icon: "fas fa-user-graduate",
                        color: "#795548"
                    },
                    { 
                        id: "Ø§Ù„ØªØ§Ø³Ø¹", 
                        name: "Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ø³Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", 
                        sections: ["Ø£", "Ø¨", "Ø¬"],
                        icon: "fas fa-user-graduate",
                        color: "#607D8B"
                    }
                ]
            }
        ];
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let isLoading = false;
        let currentGrade = '';
        let currentSection = '';
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®
        // ============================================
        
        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹)
        function getCurrentSaturdayDate() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0=Ø§Ù„Ø£Ø­Ø¯, 1=Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†, ..., 6=Ø§Ù„Ø³Ø¨Øª
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¨Øª
            let daysToSubtract = 0;
            if (dayOfWeek === 0) { // Ø§Ù„Ø£Ø­Ø¯
                daysToSubtract = 1;
            } else if (dayOfWeek === 6) { // Ø§Ù„Ø³Ø¨Øª
                daysToSubtract = 0;
            } else {
                daysToSubtract = dayOfWeek + 1;
            }
            
            const saturday = new Date(today);
            saturday.setDate(today.getDate() - daysToSubtract);
            saturday.setHours(0, 0, 0, 0);
            
            return saturday;
        }
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© dd/mm/yyyy
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentWeekInfo() {
            const saturday = getCurrentSaturdayDate();
            const wednesday = new Date(saturday);
            wednesday.setDate(saturday.getDate() + 4);
            
            return {
                saturday: saturday,
                wednesday: wednesday,
                saturdayFormatted: formatDate(saturday),
                wednesdayFormatted: formatDate(wednesday),
                weekRange: `${formatDate(saturday)} - ${formatDate(wednesday)}`,
                saturdayDisplay: formatDate(saturday)
            };
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getTodayInfo() {
            const today = new Date();
            const days = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
            const dayName = days[today.getDay()];
            
            return {
                date: formatDate(today),
                dayName: dayName,
                dateObj: today
            };
        }
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶
        // ============================================
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function showMessage(text, type = 'info', duration = 5000) {
            const messageEl = document.getElementById('message');
            messageEl.innerHTML = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            if (duration > 0 && type !== 'error') {
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, duration);
            }
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
        function renderGrades() {
            const container = document.getElementById('grades-container');
            container.innerHTML = '';
            
            const weekInfo = getCurrentWeekInfo();
            const todayInfo = getTodayInfo();
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const weekInfoHTML = `
                <div class="grade-section">
                    <div class="section-title">
                        <i class="fas fa-calendar-week"></i>
                        Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
                    </div>
                    <div class="week-info">
                        <div class="week-title">
                            <i class="fas fa-calendar-alt"></i>
                            Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©
                        </div>
                        <div class="week-dates">
                            ${weekInfo.weekRange}
                        </div>
                        <div class="week-subtitle">
                            ${todayInfo.dayName} - ${todayInfo.date}
                        </div>
                        <div class="week-subtitle" style="margin-top: 10px; font-size: 0.9rem; color: #2a5298;">
                            <i class="fas fa-filter"></i> ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©: 
                            Ø§Ù„ØµÙ + Ø§Ù„Ø´Ø¹Ø¨Ø© + ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª (${weekInfo.saturdayDisplay})
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = weekInfoHTML;
            
            // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
            SCHOOL_GRADES.forEach(section => {
                const sectionDiv = createGradeSection(section);
                container.appendChild(sectionDiv);
            });
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ù„Ù„ØµÙÙˆÙ
        function createGradeSection(sectionData) {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'grade-section';
            
            sectionDiv.innerHTML = `
                <div class="section-title">
                    <i class="${sectionData.icon}"></i>
                    ${sectionData.title}
                </div>
                <div class="grades-grid">
                    ${sectionData.grades.map(grade => 
                        grade.sections.map(section => `
                            <div class="grade-card" 
                                 data-grade="${grade.id}" 
                                 data-section="${section}"
                                 style="border-color: ${grade.color};">
                                <i class="${grade.icon}" style="color: ${grade.color};"></i>
                                <h3>${grade.name}</h3>
                                <div class="section" style="background: ${grade.color}">
                                    ${section === "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨" ? section : `Ø§Ù„Ø´Ø¹Ø¨Ø© ${section}`}
                                    <span class="week-badge">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                                </div>
                            </div>
                        `).join('')
                    ).join('')}
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµÙÙˆÙ
            sectionDiv.querySelectorAll('.grade-card').forEach(card => {
                card.addEventListener('click', function() {
                    const grade = this.dataset.grade;
                    const section = this.dataset.section;
                    const gradeName = `${getGradeFullName(grade)} - ${section === "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨" ? section : `Ø§Ù„Ø´Ø¹Ø¨Ø© ${section}`}`;
                    
                    currentGrade = grade;
                    currentSection = section;
                    
                    loadHomeworkTripleMatch(grade, section, gradeName);
                });
            });
            
            return sectionDiv;
        }
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©)
        // ============================================
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©
        async function loadHomeworkTripleMatch(grade, section, gradeName) {
            if (isLoading) return;
            
            isLoading = true;
            showLoading(true);
            document.getElementById('grades-container').style.display = 'none';
            document.getElementById('homework-container').style.display = 'none';
            document.getElementById('message').style.display = 'none';
            
            console.log(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ø¨Ø§Øª ${gradeName} Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©`);
            
            try {
                const weekInfo = getCurrentWeekInfo();
                const saturdayDate = weekInfo.saturdayFormatted;
                
                console.log('Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø«:', {
                    grade,
                    section,
                    saturdayDate,
                    weekRange: weekInfo.weekRange
                });
                
                const data = await fetchHomeworkTripleMatch(grade, section, saturdayDate);
                handleHomeworkResponse(data, grade, section, gradeName, weekInfo);
                
            } catch (error) {
                console.error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showMessage(
                    `âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª<br>
                     <small>${error.message || 'ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'}</small>`, 
                    'error'
                );
                showGradesList();
            } finally {
                isLoading = false;
                showLoading(false);
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API
        function fetchHomeworkTripleMatch(grade, section, saturdayDate) {
            return new Promise((resolve, reject) => {
                const callbackName = 'hw_' + Math.random().toString(36).substr(2, 9);
                const timeoutId = setTimeout(() => {
                    cleanup();
                    reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (15 Ø«Ø§Ù†ÙŠØ©)'));
                }, 15000);
                
                function cleanup() {
                    clearTimeout(timeoutId);
                    delete window[callbackName];
                    const script = document.getElementById(`script_${callbackName}`);
                    if (script && script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                }
                
                window[callbackName] = function(data) {
                    cleanup();
                    resolve(data);
                };
                
                // Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· API Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø©
                const url = `${STUDENT_API_URL}?action=getHomework&grade=${encodeURIComponent(grade)}&section=${encodeURIComponent(section)}&saturdayDate=${encodeURIComponent(saturdayDate)}&callback=${callbackName}&t=${Date.now()}`;
                
                console.log('Ø±Ø§Ø¨Ø· API:', url);
                
                const script = document.createElement('script');
                script.id = `script_${callbackName}`;
                script.src = url;
                
                script.onerror = function() {
                    cleanup();
                    reject(new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª - ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø§Ø¨Ø· API'));
                };
                
                document.body.appendChild(script);
            });
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function handleHomeworkResponse(data, grade, section, gradeName, weekInfo) {
            console.log('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:', data);
            
            if (!data) {
                showMessage('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±', 'error');
                showGradesList();
                return;
            }
            
            if (data.error || data.success === false) {
                showMessage(`âŒ Ø®Ø·Ø£: ${data.error || data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'error');
                showGradesList();
                return;
            }
            
            let homeworkData = data.homework || {};
            
            if (data.exists === false || !homeworkData) {
                let message = `ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù€ ${gradeName} Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ`;
                message += `<br><small>ØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¹Ù„Ù‰: Ø§Ù„ØµÙ + Ø§Ù„Ø´Ø¹Ø¨Ø© + ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª (${weekInfo.saturdayDisplay})</small>`;
                
                if (data.stats && data.stats.totalRows > 0) {
                    message += `<br><small>ØªÙ… ÙØ­Øµ ${data.stats.totalRows} ØµÙ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</small>`;
                }
                
                showMessage(message, 'info');
                showHomeworkTable(grade, section, gradeName, homeworkData, weekInfo, data);
                return;
            }
            
            const totalHomework = countTotalHomework(homeworkData);
            showMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${totalHomework} ÙˆØ§Ø¬Ø¨ Ù„Ù€ ${gradeName} Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ`, 'success', 3000);
            showHomeworkTable(grade, section, gradeName, homeworkData, weekInfo, data);
        }
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        // ============================================
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
        function showHomeworkTable(grade, section, gradeName, homeworkData, weekInfo, serverData) {
            const container = document.getElementById('homework-container');
            const todayInfo = getTodayInfo();
            
            let html = `
                <div class="week-info">
                    <div class="week-title">
                        <i class="fas fa-calendar-week"></i>
                        Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
                        <span class="today-badge">${todayInfo.dayName}</span>
                    </div>
                    <div class="week-dates">
                        ${weekInfo.weekRange}
                    </div>
                    <div class="week-subtitle">
                        ÙˆØ§Ø¬Ø¨Ø§Øª ${gradeName}
                    </div>
                    <div class="week-subtitle" style="margin-top: 10px; font-size: 0.9rem; color: #2a5298;">
                        <i class="fas fa-filter"></i> ØªÙ…Øª Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©
                    </div>
                </div>
                
                <div class="homework-header">
                    <h2 class="homework-title">
                        <i class="fas fa-tasks"></i>
                        ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
                    </h2>
                    <div class="homework-actions">
                        <button class="refresh-btn" onclick="refreshHomework()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                        <button class="back-btn" onclick="showGradesList()">
                            <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø©
                        </button>
                    </div>
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
            if (serverData.matchDetails && serverData.matchDetails.length > 0) {
                html += `
                    <div class="week-filter-info">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${serverData.matchDetails.length} ØµÙ Ù…Ø·Ø§Ø¨Ù‚</strong><br>
                            <small>ØªÙ…Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¹Ù„Ù‰: Ø§Ù„ØµÙ (${grade}) + Ø§Ù„Ø´Ø¹Ø¨Ø© (${section}) + ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª (${weekInfo.saturdayDisplay})</small>
                        </div>
                    </div>
                `;
            }
            
            // Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
            const stats = calculateHomeworkStats(homeworkData);
            
            if (stats.totalHomework > 0) {
                html += `
                    <div class="data-info">
                        <i class="fas fa-chart-bar"></i>
                        <div>
                            <strong>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</strong><br>
                            ${stats.totalSubjects} Ù…Ø§Ø¯Ø© â€¢ ${stats.totalHomework} ÙˆØ§Ø¬Ø¨ â€¢ ${stats.daysWithHomework} ÙŠÙˆÙ…
                        </div>
                    </div>
                `;
            }
            
            if (stats.totalHomework === 0) {
                html += createNoHomeworkMessage(gradeName, weekInfo, serverData);
            } else {
                html += createHomeworkTable(homeworkData, weekInfo, todayInfo);
            }
            
            container.innerHTML = html;
            container.style.display = 'block';
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
            document.getElementById('last-update').textContent = new Date().toLocaleString('ar-SA');
        }
        
        // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
        function calculateHomeworkStats(homeworkData) {
            let totalSubjects = 0;
            let totalHomework = 0;
            let daysWithHomework = 0;
            const subjectsSet = new Set();
            
            DAYS.forEach(day => {
                const dayData = homeworkData[day] || [];
                if (dayData.length > 0) {
                    daysWithHomework++;
                    dayData.forEach(item => {
                        totalHomework++;
                        if (item.subject) subjectsSet.add(item.subject);
                    });
                }
            });
            
            totalSubjects = subjectsSet.size;
            
            return { totalSubjects, totalHomework, daysWithHomework };
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙˆØ§Ø¬Ø¨Ø§Øª
        function createNoHomeworkMessage(gradeName, weekInfo, serverData) {
            let details = '';
            
            if (serverData.stats) {
                details = `<p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    <i class="fas fa-search"></i> 
                    ØªÙ… ÙØ­Øµ ${serverData.stats.totalRows} ØµÙ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </p>`;
            }
            
            return `
                <div class="no-homework">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px; color: #ccc;"></i>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
                    <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ø¬Ø¨Ø§Øª Ù„Ù€ ${gradeName} Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ.</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        <i class="fas fa-calendar-alt"></i> 
                        Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©: ${weekInfo.weekRange}
                    </p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        <i class="fas fa-filter"></i> 
                        ØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©
                    </p>
                    ${details}
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #888;">
                        <i class="fas fa-lightbulb"></i> 
                        ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ù…
                    </p>
                </div>
            `;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
        function createHomeworkTable(homeworkData, weekInfo, todayInfo) {
            let tableHTML = `
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 15%;">Ø§Ù„ÙŠÙˆÙ…</th>
                                <th style="width: 85%;">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            DAYS.forEach((day, index) => {
                const dayData = homeworkData[day] || [];
                
                // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
                const dayDate = new Date(weekInfo.saturday);
                dayDate.setDate(weekInfo.saturday.getDate() + index);
                const dayDateFormatted = formatDate(dayDate);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
                const isToday = todayInfo.dateObj.getDate() === dayDate.getDate() &&
                               todayInfo.dateObj.getMonth() === dayDate.getMonth() &&
                               todayInfo.dateObj.getFullYear() === dayDate.getFullYear();
                
                tableHTML += `
                    <tr>
                        <td class="day-header ${isToday ? 'current-day' : ''}">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${day}</div>
                            <div style="font-size: 0.9rem; color: #666; margin-bottom: 3px;">
                                ${dayDateFormatted}
                                ${isToday ? '<span class="today-badge">Ø§Ù„ÙŠÙˆÙ…</span>' : ''}
                            </div>
                            <div style="font-size: 0.8rem; color: #888;">
                                ${dayData.length} ÙˆØ§Ø¬Ø¨
                            </div>
                        </td>
                        <td>
                `;
                
                if (dayData.length > 0) {
                    dayData.forEach((item, itemIndex) => {
                        tableHTML += `
                            <div class="subject-item" style="animation-delay: ${itemIndex * 0.1}s;">
                                <div class="subject-name">
                                    <i class="fas fa-book"></i>
                                    ${item.subject || 'Ù…Ø§Ø¯Ø©'}
                                    ${item.teacher ? `<span style="font-size: 0.8rem; color: #666; margin-right: 10px;">(${item.teacher})</span>` : ''}
                                </div>
                                <div class="homework-text">
                                    <i class="fas fa-tasks" style="color: #666; font-size: 0.8rem;"></i>
                                    ${item.homework || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨ Ù…Ø­Ø¯Ø¯'}
                                </div>
                               
                            </div>
                        `;
                    });
                } else {
                    tableHTML += `
                        <div class="no-homework" style="margin: 0; text-align: center;">
                            <i class="fas fa-coffee"></i>
                            Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ù„ÙŠÙˆÙ… ${day}
                        </div>
                    `;
                }
                
                tableHTML += `
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center; font-size: 0.9rem; color: #666;">
                    <i class="fas fa-info-circle"></i>
                    ØªÙ… Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ø¨Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©: ${weekInfo.weekRange}
                    <br>
                    <small style="color: #2a5298;">
                        <i class="fas fa-info-circle"></i> Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ…Øª Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© (Ø§Ù„ØµÙ + Ø§Ù„Ø´Ø¹Ø¨Ø© + ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª)
                    </small>
                </div>
            `;
            
            return tableHTML;
        }
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„ØµÙ
        function getGradeFullName(gradeId) {
            const gradeNames = {
                "Ø§Ù„Ø£ÙˆÙ„": "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
                "Ø§Ù„Ø«Ø§Ù†ÙŠ": "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
                "Ø§Ù„Ø«Ø§Ù„Ø«": "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
                "Ø§Ù„Ø±Ø§Ø¨Ø¹": "Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ",
                "Ø§Ù„Ø®Ø§Ù…Ø³": "Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ",
                "Ø§Ù„Ø³Ø§Ø¯Ø³": "Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ",
                "Ø§Ù„Ø³Ø§Ø¨Ø¹": "Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ",
                "Ø§Ù„Ø«Ø§Ù…Ù†": "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù…Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ",
                "Ø§Ù„ØªØ§Ø³Ø¹": "Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ø³Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ"
            };
            
            return gradeNames[gradeId] || `Ø§Ù„ØµÙ ${gradeId}`;
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
        function countTotalHomework(homeworkData) {
            let total = 0;
            DAYS.forEach(day => {
                total += (homeworkData[day] || []).length;
            });
            return total;
        }
        
        // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙˆÙ
        function showGradesList() {
            document.getElementById('homework-container').style.display = 'none';
            document.getElementById('grades-container').style.display = 'block';
            document.getElementById('message').style.display = 'none';
            showLoading(false);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function refreshHomework() {
            if (!currentGrade || !currentSection) return;
            
            const gradeName = `${getGradeFullName(currentGrade)} - ${currentSection === "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨" ? currentSection : `Ø§Ù„Ø´Ø¹Ø¨Ø© ${currentSection}`}`;
            loadHomeworkTripleMatch(currentGrade, currentSection, gradeName);
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        function testConnection() {
            const callbackName = 'test_callback_' + Date.now();
            
            window[callbackName] = function(data) {
                delete window[callbackName];
                
                if (data && data.success) {
                    showMessage(
                        `âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­!<br>
                         ğŸ“Š Ø§Ù„Ù†Ø¸Ø§Ù…: ${data.system || 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø§Ø¨'}<br>
                         â° Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleString('ar-SA')}<br>
                         ğŸ“ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${data.message}<br>
                         <small>Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${data.version || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</small>`, 
                        'success',
                        6000
                    );
                } else {
                    showMessage(
                        `âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„<br>
                         Ø§Ù„Ø³Ø¨Ø¨: ${data?.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 
                        'error'
                    );
                }
            };
            
            const script = document.createElement('script');
            const url = `${STUDENT_API_URL}?action=ping&callback=${callbackName}&t=${Date.now()}`;
            script.src = url;
            
            script.onerror = function() {
                showMessage(
                    'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª<br>' +
                    '<small>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø±</small>', 
                    'error'
                );
                delete window[callbackName];
            };
            
            document.body.appendChild(script);
        }
        
        // Ø¹Ø±Ø¶ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function showInstructions() {
            const weekInfo = getCurrentWeekInfo();
            
            showMessage(
                `ğŸ“š <strong>ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…:</strong><br>
                1. Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©<br>
                2. Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©<br>
                3. Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ<br>
                4. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "ØªØ­Ø¯ÙŠØ«" Ù„Ø£Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª<br><br>
                
                <i class="fas fa-calendar-alt"></i> <strong>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong><br>
                ${weekInfo.weekRange}<br><br>
                
                <i class="fas fa-filter"></i> <strong>Ù…Ø¨Ø¯Ø£ Ø§Ù„ÙÙ„ØªØ±Ø©:</strong><br>
                â€¢ ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©:<br>
                &nbsp;&nbsp;âœ“ Ø§Ù„ØµÙ (Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ)<br>
                &nbsp;&nbsp;âœ“ Ø§Ù„Ø´Ø¹Ø¨Ø© (Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ)<br>
                &nbsp;&nbsp;âœ“ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª (${weekInfo.saturdayDisplay})<br>
                â€¢ ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·<br>
                â€¢ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªØ­Ø¯ÙŠØ«"`,
                'info',
                10000
            );
        }
        
        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function showCurrentWeekInfo() {
            const weekInfo = getCurrentWeekInfo();
            const todayInfo = getTodayInfo();
            
            showMessage(
                `<i class="fas fa-calendar-week"></i> <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong><br>
                 ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª (Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹): ${weekInfo.saturdayDisplay}<br>
                 ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ (Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹): ${weekInfo.wednesdayFormatted}<br>
                 Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${todayInfo.dayName} - ${todayInfo.date}<br><br>
                 
                 <i class="fas fa-database"></i> <strong>Ù…Ø¨Ø¯Ø£ Ø§Ù„ÙÙ„ØªØ±Ø©:</strong><br>
                 ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙŠ ØªØ·Ø§Ø¨Ù‚:<br>
                 1. Ø§Ù„ØµÙ (Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)<br>
                 2. Ø§Ù„Ø´Ø¹Ø¨Ø© (Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)<br>
                 3. ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ J (${weekInfo.saturdayDisplay})<br><br>
                 
                 <i class="fas fa-lightbulb"></i> <strong>Ù…Ø«Ø§Ù„:</strong><br>
                 Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù…Ù† - Ø´Ø¹Ø¨Ø© Ø¨"<br>
                 Ø³ÙŠØ¨Ø­Ø« Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù† Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:<br>
                 Ø§Ù„ØµÙ: "Ø§Ù„Ø«Ø§Ù…Ù†" ÙˆØ§Ù„Ø´Ø¹Ø¨Ø©: "Ø¨" ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª: "${weekInfo.saturdayDisplay}"`,
                'info',
                12000
            );
        }
        
        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            renderGrades();
            
            setTimeout(() => {
                const weekInfo = getCurrentWeekInfo();
                const todayInfo = getTodayInfo();
                showMessage(
                    `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©<br>
                     <i class="fas fa-calendar-week"></i> Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©: ${weekInfo.weekRange}<br>
                     <i class="fas fa-clock"></i> Ø§Ù„ÙŠÙˆÙ…: ${todayInfo.dayName} - ${todayInfo.date}<br>
                     <i class="fas fa-filter"></i> ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©<br>
                     Ø§Ø®ØªØ± Ø§Ù„ØµÙ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© Ù„Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ`,
                    'info',
                    8000
                );
            }, 1000);
        });
        
        // ============================================
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…Ø©
        // ============================================
        
        window.addEventListener('error', function(e) {
            console.error('Ø­Ø¯Ø« Ø®Ø·Ø£:', e.error);
        });
        
        window.addEventListener('offline', function() {
            showMessage('âš ï¸ ÙÙ‚Ø¯Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'error');
        });
        
        window.addEventListener('online', function() {
            showMessage('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success', 3000);
        });
    </script>
</body>
</html>