<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¯Ø§Ø±Ø³ Ø¹Ù…Ø±Ø§Ù† Ø§Ù„Ø§Ù‡Ù„ÙŠØ© - Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet" />
  <!-- Ù…ÙƒØªØ¨Ø© html2pdf.js Ù„ØªØ­ÙˆÙŠÙ„ HTML Ø¥Ù„Ù‰ PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      background-color: #f9f9f9;
    }
    .page-container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border: 3px solid #4CAF50;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    header {
      background-color: #e8f5e9;
      color: black;
      padding: 10px 15px;
      border-radius: 8px;
    }
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: center;
      flex-wrap: nowrap;
    }
    .header-right img {
      height: 60px;
    }
    .header-center {
      flex: 1;
      padding: 0 10px;
    }
    .header-center h1 {
      margin: 5px 0;
      font-size: 20px;
    }
    .header-center h2 {
      margin: 0;
      font-size: 16px;
    }
    .header-left {
      text-align: right;
      font-size: 12px;
      line-height: 1.5;
      max-width: 30%;
    }
    .home-button, .print-button, .pdf-button {
      display: inline-block;
      margin: 10px 5px;
      padding: 8px 12px;
      background-color: #4CAF50;
      color: white;
      text-decoration: none;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    .print-button {
      background-color: #2196F3;
    }
    .pdf-button {
      background-color: #f44336;
    }
    .home-button:hover {
      background-color: #45a049;
    }
    .print-button:hover {
      background-color: #1976D2;
    }
    .pdf-button:hover {
      background-color: #d32f2f;
    }
    .btn-choice {
      margin: 5px;
      padding: 10px 20px;
      font-size: 15px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #e0f7fa;
    }
    #resultsForm label {
      font-size: 13px;
      color: #444;
      margin-bottom: 5px;
      display: inline-block;
    }
    #resultsForm input[type="text"] {
      width: 200px;
      padding: 5px 10px;
      font-size: 13px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 5px 0;
    }
    #resultsForm button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 6px 14px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 5px;
    }
    #resultsForm button:hover {
      background-color: #388e3c;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 12px;
    }
    th, td {
      border: 1px solid black;
      padding: 3px;
      height: 15px;
      text-align: center;
      vertical-align: middle;
    }
    h4 {
      font-size: 1px;
      margin: 0;
      line-height: 0.1;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
    .print-optimized {
      page-break-inside: avoid;
    }
    .compact-table {
      font-size: 11px;
    }
    .compact-table th,
    .compact-table td {
      padding: 2px;
      height: 12px;
    }
    
    @media (max-width: 600px) {
      .header-container {
        flex-wrap: nowrap;
        flex-direction: row;
      }
      .header-right img {
        height: 50px;
      }
      .header-left {
        font-size: 11px;
      }
      .header-center h1 {
        font-size: 18px;
      }
      .header-center h2 {
        font-size: 14px;
      }
    }
    
    @media print {
      body {
        background: white;
        margin: 0;
        padding: 0;
      }
      .page-container {
        box-shadow: none;
        border: 2px solid black;
        margin: 0;
        padding: 10px;
        max-width: 100%;
        width: 100%;
      }
      .home-button,
      .print-button,
      .pdf-button,
      #choiceSection {
        display: none !important;
      }
      #results {
        display: block !important;
        margin-top: 0;
      }
      #resultsForm {
        display: none !important;
      }
      table {
        font-size: 10px;
      }
      th, td {
        padding: 1px;
        height: 10px;
      }
    }
  </style>
</head>
<body>
<div class="page-container">
  <header>
    <div class="header-container">
      <div class="header-left">
        <p>Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙŠÙ…Ù†ÙŠØ©</p>
        <p>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…</p>
        <p>Ù…ÙƒØªØ¨ Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… - Ù…/ Ø¹Ù…Ø±Ø§Ù†</p>
      </div>
      <div class="header-center">
        <h1>Ù…Ø¯Ø§Ø±Ø³ Ø¹Ù…Ø±Ø§Ù† Ø§Ù„Ø§Ù‡Ù„ÙŠØ©</h1>
        <h2 id="pageTitle">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ©</h2>
      </div>
      <div class="header-right">
        <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" />
      </div>
    </div>
  </header>

  <div style="text-align:center;">
    <a href="index.html" class="home-button">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#" class="print-button" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø©</a>
    <a href="#" class="pdf-button" id="savePdfButton" style="display:none;">ğŸ“„ Ø­ÙØ¸ ÙƒÙ€ PDF</a>
  </div>

  <section id="choiceSection" style="text-align: center; margin-top: 30px;">
    <h3>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©:</h3>
    <button class="btn-choice" data-api="API_Ù…Ø­Ø±Ù…" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ù…Ø­Ø±Ù…">ğŸ“˜ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ù…Ø­Ø±Ù…</button>
    <button class="btn-choice" data-api="API_ØµÙØ±" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± ØµÙØ±">ğŸ“˜ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± ØµÙØ±</button>
    <button class="btn-choice" data-api="API_Ø±Ø¨ÙŠØ¹_Ø§ÙˆÙ„" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø±Ø¨ÙŠØ¹ Ø£ÙˆÙ„">ğŸ“˜ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø±Ø¨ÙŠØ¹ Ø£ÙˆÙ„</button>
    <button class="btn-choice" data-api="API_Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…">ğŸ“— Ù†ØªÙŠØ¬Ø© Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…</button>
    <button class="btn-choice" data-api="API_Ø¬Ù…Ø§Ø¯_Ø§ÙˆÙ„" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø£ÙˆÙ„">ğŸ“™ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø£ÙˆÙ„</button>
    <button class="btn-choice" data-api="API_Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø«Ø§Ù†ÙŠ">ğŸ“™ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø«Ø§Ù†ÙŠ</button>
    <button class="btn-choice" data-api="API_Ø±Ø¬Ø¨" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø±Ø¬Ø¨">ğŸ“™ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø±Ø¬Ø¨</button>
    <button class="btn-choice" data-api="API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…">ğŸ“• Ù†ØªÙŠØ¬Ø© Ø¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…</button>
  </section>

  <section id="results" style="display: none; text-align:center; margin-top: 30px;">
    <form id="resultsForm">
      <label for="studentCode">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
      <input type="text" id="studentCode" name="studentCode" required />
      <button type="submit">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    </form>
    <div id="resultsOutput"></div>
  </section>

</div>

<script>
  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠØ©
  function convertToEnglishNumbers(input) {
    return input.replace(/[\u0660-\u0669]/g, function (c) {
      return c.charCodeAt(0) - 0x0660;
    });
  }

  let currentApiUrl = "";
  let currentApiKey = "";
  let currentStudentCode = "";
  let currentStudentData = null;
  let currentResultType = "";

  // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
  document.querySelectorAll(".btn-choice").forEach((btn) => {
    btn.addEventListener("click", () => {
      const apiKey = btn.dataset.api;
      const pageTitle = btn.dataset.title;

      // Ø±ÙˆØ§Ø¨Ø· API Ø­Ø³Ø¨ Ø§Ù„ÙˆØ±Ù‚Ø©
      const apiMap = {
        API_Ù…Ø­Ø±Ù…: "https://script.google.com/macros/s/AKfycbz8kLBv7_sUig3ePwqTlnEA0ef7feYQlAz9ju1xxPq8_HmQ6PJki9xGZH2PWwQhGaY4/exec",
        API_ØµÙØ±: "https://script.google.com/macros/s/AKfycbyVy7VR-bzcgoy5RIY9NrYcE4xH82k-2aGvl_wn2JeDqS9szKObLjA78xyHZrLSl1vs_g/exec",
        API_Ø±Ø¨ÙŠØ¹_Ø§ÙˆÙ„: "https://script.google.com/macros/s/yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy/exec",
        API_Ø¬Ù…Ø§Ø¯_Ø§ÙˆÙ„: "https://script.google.com/macros/s/AKfycbx-vVS2ZyBzgEvvDF82mX09cdIf5pQs1DvxBZdkPl7jqqVXmSWn-1SI6W-iMUR_b2on/exec",
        API_Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ: "https://script.google.com/macros/s/AKfycbyYbX8k0t-4QmM5Oso-MgCSKGDKhsocQvNQa-y6SfzQsj30vZ1RmqNmcsVwjGy07f8P/exec",
        API_Ø±Ø¬Ø¨: "https://script.google.com/macros/s/AKfycbyuZ8XvrSSMbKFi3VuxlorkYCzheRzvr6b68cD-UKrjyl6n30C_20UEIKjtj41ahsdH/exec",
        API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…: "https://script.google.com/macros/s/AKfycbzyke1TJBz043kykDBaCQgAGOO4nq8UWUktiaX-uSd_-qhVCvhwwVhyK68pxs0d5Gqm/exec",
      };

      currentApiUrl = apiMap[apiKey];
      currentApiKey = apiKey;
      currentResultType = apiKey;

      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
      document.getElementById("pageTitle").textContent = pageTitle;

      document.getElementById("choiceSection").style.display = "none";
      document.getElementById("results").style.display = "block";
      document.getElementById("resultsOutput").innerHTML = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.getElementById("savePdfButton").style.display = "none"; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± PDF
    });
  });

  // Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  document.getElementById("resultsForm").addEventListener("submit", function (event) {
    event.preventDefault();

    let studentCode = document.getElementById("studentCode").value.trim();
    studentCode = convertToEnglishNumbers(studentCode);
    currentStudentCode = studentCode;

    if (!studentCode) {
      alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨!");
      return;
    }

    fetch(`${currentApiUrl}?code=${studentCode}`)
      .then((response) => response.json())
      .then((data) => {
        const output = document.getElementById("resultsOutput");
        output.innerHTML = "";

        if (data.status !== "Ù†Ø¬Ø§Ø­") {
          output.innerHTML = `<p style="color: red;">${data.message}</p>`;
          document.getElementById("savePdfButton").style.display = "none";
          return;
        }

        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹
        currentStudentData = data;

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
        let studentInfo = `<h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3><table border="1" class="compact-table"><tr><th>Ø§Ù„Ù…Ø¬Ø§Ù„</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr>`;
        for (const [key, value] of Object.entries(data.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨)) {
          studentInfo += `<tr><td><strong>${key}</strong></td><td>${value || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td></tr>`;
        }
        studentInfo += `</table>`;

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        let subjectsTable = createSubjectsTable(data.Ø§Ù„Ù…ÙˆØ§Ø¯_Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©, currentResultType);

        // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        let finalResults = `<h3>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3><table border="1" class="compact-table"><tr><th>Ø§Ù„Ù…Ø¬Ø§Ù„</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr>`;
        finalResults += `<tr><td>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</td><td>${data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹_Ø§Ù„ÙƒÙ„ÙŠ || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td></tr>`;
        finalResults += `<tr><td>Ø§Ù„Ù†Ø³Ø¨Ø©</td><td>${data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„Ù†Ø³Ø¨Ø© || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}%</td></tr>`;
        finalResults += `<tr><td>Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</td><td>${data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„Ù†ØªÙŠØ¬Ø© || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td></tr>`;
        finalResults += `<tr><td>Ø§Ù„ØªØ±ØªÙŠØ¨</td><td>${data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„ØªØ±ØªÙŠØ¨ || ""}</td></tr>`;
        finalResults += `</table>`;

        output.innerHTML = studentInfo + subjectsTable + finalResults;
        document.getElementById("savePdfButton").style.display = "inline-block";
        
        // Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        document.getElementById("resultsForm").style.display = "none";

        // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
        logViewToGoogleSheet(studentCode, data.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨.Ø§Ù„Ø§Ø³Ù…, currentApiKey);
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
        document.getElementById("savePdfButton").style.display = "none";
      });
  });

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©
  function createSubjectsTable(subjectsData, resultType) {
    let tableHeader = "";
    let tableRows = "";

    // ØªØ­Ø¯ÙŠØ¯ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    if (resultType === "API_Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…") {
      // Ø¬Ø¯ÙˆÙ„ Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…
      tableHeader = `<h4></h4><table border="1" class="compact-table"><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</th><th>Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th></tr>`;
      
      for (const [subject, grades] of Object.entries(subjectsData)) {
        tableRows += `<tr>
          <td>${subject}</td>
          <td>${grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø£ÙˆÙ„Ù‰ || ""}</td>
          <td>${grades.Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù… || ""}</td>
          <td>${grades.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td>
        </tr>`;
      }
    } 
    else if (resultType === "API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…") {
      // Ø¬Ø¯ÙˆÙ„ Ø¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…
      tableHeader = `<h4></h4><table border="1" class="compact-table"><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</th><th>Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…</th><th>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</th><th>Ø¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th></tr>`;
      
      for (const [subject, grades] of Object.entries(subjectsData)) {
        tableRows += `<tr>
          <td>${subject}</td>
          <td>${grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø£ÙˆÙ„Ù‰ || ""}</td>
          <td>${grades.Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù… || ""}</td>
          <td>${grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø«Ø§Ù†ÙŠØ© || ""}</td>
          <td>${grades.Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù… || ""}</td>
          <td>${grades.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td>
        </tr>`;
      }
    } 
    else {
      // Ø¬Ø¯ÙˆÙ„ Ø´Ù‡Ø±ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
      tableHeader = `<h4></h4><table border="1" class="compact-table"><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ù…ÙˆØ§Ø¸Ø¨Ø©</th><th>ÙˆØ§Ø¬Ø¨Ø§Øª</th><th>Ø´ÙÙ‡ÙŠ</th><th>ØªØ­Ø±ÙŠØ±ÙŠ</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th></tr>`;
      
      for (const [subject, grades] of Object.entries(subjectsData)) {
        tableRows += `<tr>
          <td>${subject}</td>
          <td>${grades.Ù…ÙˆØ§Ø¸Ø¨Ø© || ""}</td>
          <td>${grades.Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª || ""}</td>
          <td>${grades.Ø´ÙÙ‡ÙŠ || ""}</td>
          <td>${grades.ØªØ­Ø±ÙŠØ±ÙŠ || ""}</td>
          <td>${grades.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td>
        </tr>`;
      }
    }

    return tableHeader + tableRows + `</table>`;
  }

  // Ø¯Ø§Ù„Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
  function logViewToGoogleSheet(studentCode, studentName, resultType) {
    // Ø±Ø§Ø¨Ø· API Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ (ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù€ API ÙÙŠ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª)
    const logApiUrl = "https://script.google.com/macros/s/AKfycbx-vVS2ZyBzgEvvDF82mX09cdIf5pQs1DvxBZdkPl7jqqVXmSWn-1SI6W-iMUR_b2on/exec";
    
    const logData = {
      studentCode: studentCode,
      studentName: studentName,
      resultType: resultType,
      viewDate: new Date().toISOString(),
      action: "ØªÙ… Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©"
    };

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ³Ø¬ÙŠÙ„Ù‡Ø§
    fetch(logApiUrl, {
      method: "POST",
      body: JSON.stringify(logData)
    })
    .then(response => response.json())
    .then(data => {
      console.log("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­:", data);
    })
    .catch(error => {
      console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶:", error);
    });
  }

  // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒÙ€ PDF
  document.getElementById("savePdfButton").addEventListener("click", function() {
    const element = document.getElementById("resultsOutput");
    const studentName = currentStudentData?.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨?.Ø§Ù„Ø§Ø³Ù… || "Ø·Ø§Ù„Ø¨";
    const resultType = getResultTypeName(currentApiKey);
    
    const options = {
      margin: 10,
      filename: `Ù†ØªÙŠØ¬Ø©_${studentName}_${resultType}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù€ PDF
    const header = document.querySelector('header').cloneNode(true);
    const tempContainer = document.createElement('div');
    tempContainer.appendChild(header);
    tempContainer.appendChild(element.cloneNode(true));
    
    html2pdf().from(tempContainer).set(options).save();
  });

  // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
  function getResultTypeName(apiKey) {
    const typeNames = {
      "API_Ù…Ø­Ø±Ù…": "Ù…Ø­Ø±Ù…",
      "API_ØµÙØ±": "ØµÙØ±",
      "API_Ø±Ø¨ÙŠØ¹_Ø§ÙˆÙ„": "Ø±Ø¨ÙŠØ¹_Ø£ÙˆÙ„",
      "API_Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…": "Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…",
      "API_Ø¬Ù…Ø§Ø¯_Ø§ÙˆÙ„": "Ø¬Ù…Ø§Ø¯_Ø£ÙˆÙ„",
      "API_Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ": "Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ",
      "API_Ø±Ø¬Ø¨": "Ø±Ø¬Ø¨",
      "API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…": "Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…"
    };
    
    return typeNames[apiKey] || "Ù†ØªÙŠØ¬Ø©";
  }
</script>

</html>