<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¯Ø§Ø±Ø³ Ø¹Ù…Ø±Ø§Ù† Ø§Ù„Ø§Ù‡Ù„ÙŠØ© -Ø§Ù„Ù…Ø±ÙƒØ²- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet" />
  <!-- Ù…ÙƒØªØ¨Ø© html2pdf.js Ù„ØªØ­ÙˆÙŠÙ„ HTML Ø¥Ù„Ù‰ PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .page-container {
      max-width: 850px;
      width: 100%;
      margin: 10px auto;
      padding: 15px;
      background: white;
      border: 2px solid #4CAF50;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
      position: relative;
    }
    header {
      background-color: #e8f5e9;
      color: black;
      padding: 8px 12px;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: center;
      flex-wrap: nowrap;
    }
    .header-right img {
      height: 50px;
    }
    .header-center {
      flex: 1;
      padding: 0 8px;
    }
    .header-center h1 {
      margin: 3px 0;
      font-size: 18px;
    }
    .header-center h2 {
      margin: 0;
      font-size: 14px;
    }
    .header-left {
      text-align: right;
      font-size: 11px;
      line-height: 1.3;
      max-width: 30%;
    }
    .home-button, .print-button, .pdf-button {
      display: inline-block;
      margin: 5px 3px;
      padding: 6px 10px;
      background-color: #4CAF50;
      color: white;
      text-decoration: none;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
    }
    .print-button {
      background-color: #2196F3;
    }
    .pdf-button {
      background-color: #f44336;
    }
    .home-button:hover {
      background-color: #45a049;
    }
    .print-button:hover {
      background-color: #1976D2;
    }
    .pdf-button:hover {
      background-color: #d32f2f;
    }
    .btn-choice {
      margin: 3px;
      padding: 8px 15px;
      font-size: 13px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background-color: #e0f7fa;
    }
    #resultsForm label {
      font-size: 12px;
      color: #444;
      margin-bottom: 3px;
      display: inline-block;
    }
    #resultsForm input[type="text"] {
      width: 180px;
      padding: 4px 8px;
      font-size: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin: 3px 0;
    }
    #resultsForm button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 5px 12px;
      font-size: 13px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 3px;
    }
    #resultsForm button:hover {
      background-color: #388e3c;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù†ØªØ§Ø¦Ø¬ */
    .results-container {
      margin-top: 15px;
      padding: 10px;
    }
    
    .student-info {
      background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      border-right: 3px solid #4CAF50;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .student-info h3 {
      color: #2c3e50;
      margin-top: 0;
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 1px solid #4CAF50;
      text-align: center;
      font-size: 1.2em;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
    
    .info-item {
      background: white;
      padding: 8px;
      border-radius: 5px;
      border-right: 3px solid #3498db;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .info-label {
      color: #7f8c8d;
      font-size: 0.85em;
      margin-bottom: 3px;
      display: block;
    }
    
    .info-value {
      color: #2c3e50;
      font-size: 1em;
      font-weight: 600;
    }
    
    .subjects-table-container {
      overflow-x: auto;
      margin: 15px 0;
    }
    
    .subjects-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      border-radius: 5px;
      overflow: hidden;
    }
    
    .subjects-table th {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: white;
      padding: 10px 6px;
      text-align: center;
      font-weight: 600;
      border: none;
      font-size: 11px;
      height: 25px;
    }
    
    .subjects-table td {
      padding: 8px 6px;
      text-align: center;
      border: none;
      border-bottom: 1px solid #e0e0e0;
      height: 25px;
    }
    
    .subjects-table tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    
    .subjects-table tr:hover {
      background-color: #e8f5e9;
    }
    
    .subjects-table tr:last-child td {
      border-bottom: none;
    }
    
    .subjects-table .subject-name {
      text-align: right;
      font-weight: 600;
      color: #2c3e50;
      background-color: #f1f8e9;
      padding-right: 10px;
    }
    
    .final-results {
      background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    
    .final-results h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.3em;
      color: white;
    }
    
    .final-results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
    }
    
    .final-result-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 12px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .final-result-label {
      font-size: 0.85em;
      margin-bottom: 6px;
      color: #e0e0e0;
      display: block;
    }
    
    .final-result-value {
      font-size: 1.4em;
      font-weight: 700;
      color: white;
    }
    
    .result-status {
      font-size: 1.1em;
      padding: 8px 15px;
      border-radius: 20px;
      display: inline-block;
      margin-top: 10px;
      font-weight: 700;
      background-color: #4CAF50;
      color: white;
    }
    
    .section-title {
      color: #2c3e50;
      margin: 20px 0 10px 0;
      padding-right: 12px;
      border-right: 3px solid #4CAF50;
      font-size: 1.1em;
    }
    
    .grade-high {
      color: #27ae60;
      font-weight: bold;
    }
    
    .grade-medium {
      color: #f39c12;
      font-weight: bold;
    }
    
    .grade-low {
      color: #e74c3c;
      font-weight: bold;
    }
    
    .alert-message {
      padding: 15px;
      background-color: #ffebee;
      color: #c62828;
      border-radius: 6px;
      border-right: 3px solid #c62828;
      margin: 15px 0;
      text-align: center;
      font-size: 1em;
    }
    
    .success-message {
      padding: 15px;
      background-color: #e8f5e9;
      color: #2e7d32;
      border-radius: 6px;
      border-right: 3px solid #4CAF50;
      margin: 15px 0;
      text-align: center;
      font-size: 1em;
    }
    
    .no-title {
      margin: 10px 0 5px 0;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
    @media (max-width: 600px) {
      body {
        padding: 5px;
      }
      
      .page-container {
        padding: 10px;
        margin: 5px;
        max-width: 100%;
      }
      
      .header-container {
        flex-wrap: nowrap;
        flex-direction: row;
      }
      .header-right img {
        height: 40px;
      }
      .header-left {
        font-size: 10px;
      }
      .header-center h1 {
        font-size: 16px;
      }
      .header-center h2 {
        font-size: 12px;
      }
      
      .info-grid {
        grid-template-columns: 1fr;
      }
      
      .final-results-grid {
        grid-template-columns: 1fr;
      }
      
      .subjects-table {
        font-size: 10px;
      }
      
      .subjects-table th,
      .subjects-table td {
        padding: 6px 4px;
        height: 20px;
      }
    }
    
    @media print {
      body {
        background: white;
        margin: 0;
        padding: 0;
        display: block;
      }
      .page-container {
        box-shadow: none;
        border: 1px solid black;
        margin: 0 auto;
        padding: 8px;
        max-width: 100%;
        width: 100%;
        page-break-inside: avoid;
      }
      .home-button,
      .print-button,
      .pdf-button,
      #choiceSection {
        display: none !important;
      }
      #results {
        display: block !important;
        margin-top: 0;
      }
      #resultsForm {
        display: none !important;
      }
      
      .student-info {
        border: 1px solid #000;
        box-shadow: none;
        padding: 8px;
        margin-bottom: 10px;
      }
      
      .subjects-table {
        box-shadow: none;
        border: 1px solid #000;
        font-size: 10px;
      }
      
      .subjects-table th {
        background: #f0f0f0 !important;
        color: black !important;
        -webkit-print-color-adjust: exact;
        padding: 6px 4px;
        height: 20px;
      }
      
      .subjects-table td {
        padding: 5px 4px;
        height: 20px;
      }
      
      .final-results {
        background: #f0f0f0 !important;
        color: black !important;
        border: 1px solid #000;
        -webkit-print-color-adjust: exact;
        padding: 10px;
        margin-top: 15px;
      }
      
      .final-result-value {
        color: black !important;
      }
      
      .result-status {
        background-color: #f0f0f0 !important;
        color: black !important;
        border: 1px solid #000;
      }
      
      /* ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
      .student-info h3 {
        font-size: 1em;
      }
      
      .info-label {
        font-size: 0.8em;
      }
      
      .info-value {
        font-size: 0.9em;
      }
      
      .final-results h3 {
        font-size: 1.1em;
      }
      
      .final-result-label {
        font-size: 0.8em;
      }
      
      .final-result-value {
        font-size: 1.2em;
      }
      
      .result-status {
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
<div class="page-container">
  <header>
    <div class="header-container">
      <div class="header-left">
        <p>Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙŠÙ…Ù†ÙŠØ©</p>
        <p>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…</p>
        <p>Ù…ÙƒØªØ¨ Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… - Ù…/ Ø¹Ù…Ø±Ø§Ù†</p>
      </div>
      <div class="header-center">
        <h1>Ù…Ø¯Ø§Ø±Ø³ Ø¹Ù…Ø±Ø§Ù† Ø§Ù„Ø§Ù‡Ù„ÙŠØ©</h1>
        <h2 id="pageTitle">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ©</h2>
      </div>
      <div class="header-right">
        <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" />
      </div>
    </div>
  </header>

  <div style="text-align:center;">
    <a href="index.html" class="home-button">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#" class="print-button" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø©</a>
    <a href="#" class="pdf-button" id="savePdfButton" style="display:none;">ğŸ“„ Ø­ÙØ¸ ÙƒÙ€ PDF</a>
  </div>

  <section id="choiceSection" style="text-align: center; margin-top: 20px;">
    <h3>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©:</h3>
    <button class="btn-choice" data-api="API_Ù…Ø­Ø±Ù…" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ù…Ø­Ø±Ù…">ğŸ“˜ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ù…Ø­Ø±Ù…</button>
    <button class="btn-choice" data-api="API_ØµÙØ±" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± ØµÙØ±">ğŸ“˜ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± ØµÙØ±</button>
    <button class="btn-choice" data-api="API_Ø±Ø¨ÙŠØ¹_Ø§ÙˆÙ„" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø±Ø¨ÙŠØ¹ Ø£ÙˆÙ„">ğŸ“˜ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø±Ø¨ÙŠØ¹ Ø£ÙˆÙ„</button>
    <button class="btn-choice" data-api="API_Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…">ğŸ“— Ù†ØªÙŠØ¬Ø© Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…</button>
    <button class="btn-choice" data-api="API_Ø¬Ù…Ø§Ø¯_Ø§ÙˆÙ„" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø£ÙˆÙ„">ğŸ“™ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø£ÙˆÙ„</button>
    <button class="btn-choice" data-api="API_Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø«Ø§Ù†ÙŠ">ğŸ“™ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø¬Ù…Ø§Ø¯ Ø«Ø§Ù†ÙŠ</button>
    <button class="btn-choice" data-api="API_Ø±Ø¬Ø¨" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø´Ù‡Ø± Ø±Ø¬Ø¨">ğŸ“™ Ù…Ø­ØµÙ„Ø© Ø´Ù‡Ø± Ø±Ø¬Ø¨</button>
    <button class="btn-choice" data-api="API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…" data-title="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© Ø¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…">ğŸ“• Ù†ØªÙŠØ¬Ø© Ø¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…</button>
  </section>

  <section id="results" style="display: none; margin-top: 20px;">
    <form id="resultsForm" style="text-align:center; margin-bottom: 20px;">
      <label for="studentCode">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
      <input type="text" id="studentCode" name="studentCode" required />
      <button type="submit">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    </form>
    <div id="resultsOutput"></div>
  </section>

</div>

<script>
  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠØ©
  function convertToEnglishNumbers(input) {
    return input.replace(/[\u0660-\u0669]/g, function (c) {
      return c.charCodeAt(0) - 0x0660;
    });
  }

  let currentApiUrl = "";
  let currentApiKey = "";
  let currentStudentCode = "";
  let currentStudentData = null;
  let currentResultType = "";

  // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
  document.querySelectorAll(".btn-choice").forEach((btn) => {
    btn.addEventListener("click", () => {
      const apiKey = btn.dataset.api;
      const pageTitle = btn.dataset.title;

      // Ø±ÙˆØ§Ø¨Ø· API Ø­Ø³Ø¨ Ø§Ù„ÙˆØ±Ù‚Ø©
      const apiMap = {
        API_Ù…Ø­Ø±Ù…: "https://script.google.com/macros/s/AKfycbz8kLBv7_sUig3ePwqTlnEA0ef7feYQlAz9ju1xxPq8_HmQ6PJki9xGZH2PWwQhGaY4/exec",
        API_ØµÙØ±: "https://script.google.com/macros/s/AKfycbyVy7VR-bzcgoy5RIY9NrYcE4xH82k-2aGvl_wn2JeDqS9szKObLjA78xyHZrLSl1vs_g/exec",
        API_Ø±Ø¨ÙŠØ¹_Ø§ÙˆÙ„: "https://script.google.com/macros/s/yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy/exec",
        API_Ø¬Ù…Ø§Ø¯_Ø§ÙˆÙ„: "https://script.google.com/macros/s/AKfycbwFDDVvBR88pPpEUPhfnqpPNaqRWp3BCUkOc2BwAKB7Nwc802hV_Ojzp7V9e--RPxlY/exec",
        API_Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ: "https://script.google.com/macros/s/AKfycbyDADpC6e37DrXCCizklRQ0GaPvO2m-lH9MaQGeWkqNH6PV_YWkQKcAbJdeA-j9dpkz/exec",
        API_Ø±Ø¬Ø¨: "https://script.google.com/yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy/exec/exec",
        API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…: "https://script.google.com/macros/s/AKfycbzyke1TJBz043kykDBaCQgAGOO4nq8UWUktiaX-qhVCvhwwVhyK68pxs0d5Gqm/exec",
      };

      currentApiUrl = apiMap[apiKey];
      currentApiKey = apiKey;
      currentResultType = apiKey;

      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
      document.getElementById("pageTitle").textContent = pageTitle;

      document.getElementById("choiceSection").style.display = "none";
      document.getElementById("results").style.display = "block";
      document.getElementById("resultsOutput").innerHTML = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.getElementById("savePdfButton").style.display = "none"; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± PDF
      document.getElementById("resultsForm").style.display = "block"; // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø«
    });
  });

  // Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  document.getElementById("resultsForm").addEventListener("submit", function (event) {
    event.preventDefault();

    let studentCode = document.getElementById("studentCode").value.trim();
    studentCode = convertToEnglishNumbers(studentCode);
    currentStudentCode = studentCode;

    if (!studentCode) {
      alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨!");
      return;
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    const output = document.getElementById("resultsOutput");
    output.innerHTML = '<div class="success-message">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>';

    fetch(`${currentApiUrl}?code=${studentCode}`)
      .then((response) => response.json())
      .then((data) => {
        output.innerHTML = "";

        if (data.status !== "Ù†Ø¬Ø§Ø­") {
          output.innerHTML = `
            <div class="alert-message">
              <h3>âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø£Ùˆ Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆÙ‚Ù</h3>
              <p>${data.message}</p>
              <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
            </div>
          `;
          document.getElementById("savePdfButton").style.display = "none";
          return;
        }

        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹
        currentStudentData = data;

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ - ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ
        let studentInfo = `
          <div class="student-info">
            <h3>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
            <div class="info-grid">
        `;
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ
        const studentFields = {
          "Ø§Ù„Ø§Ø³Ù…": data.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨?.Ø§Ù„Ø§Ø³Ù… || "ØºÙŠØ± Ù…ØªÙˆÙØ±",
          "Ø§Ù„ØµÙ": data.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨?.Ø§Ù„ØµÙ || "ØºÙŠØ± Ù…ØªÙˆÙØ±",
          "Ø§Ù„Ø´Ø¹Ø¨Ø©": data.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨?.Ø§Ù„Ø´Ø¹Ø¨Ø© || "ØºÙŠØ± Ù…ØªÙˆÙØ±",
         
        };
        
        for (const [key, value] of Object.entries(studentFields)) {
          studentInfo += `
            <div class="info-item">
              <span class="info-label">${key}</span>
              <span class="info-value">${value}</span>
            </div>
          `;
        }
        
        studentInfo += `</div></div>`;

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© - Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†
        let subjectsTable = createSubjectsTable(data.Ø§Ù„Ù…ÙˆØ§Ø¯_Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©, currentResultType);

        // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        let finalResult = data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„Ù†ØªÙŠØ¬Ø© || "ØºÙŠØ± Ù…ØªÙˆÙØ±";
        let resultClass = finalResult.includes("Ù†Ø§Ø¬Ø­") || finalResult.includes("Ù…Ù‚Ø¨ÙˆÙ„") ? "result-success" : "";
        
        let finalResults = `
          <div class="final-results">
            <h3>ğŸ† Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
            <div class="final-results-grid">
              <div class="final-result-item">
                <span class="final-result-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</span>
                <span class="final-result-value">${data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹_Ø§Ù„ÙƒÙ„ÙŠ || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
              </div>
              <div class="final-result-item">
                <span class="final-result-label">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</span>
                <span class="final-result-value">${data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„Ù†Ø³Ø¨Ø© || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</span>
              </div>
              <div class="final-result-item">
                <span class="final-result-label">Ø§Ù„ØªØ±ØªÙŠØ¨</span>
                <span class="final-result-value">${data.Ø§Ù„Ù†ØªÙŠØ¬Ø©_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©?.Ø§Ù„ØªØ±ØªÙŠØ¨ || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>
              </div>
            </div>
            <div class="result-status ${resultClass}">
              Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…: ${finalResult}
            </div>
          </div>
        `;

        output.innerHTML = studentInfo + subjectsTable + finalResults;
        document.getElementById("savePdfButton").style.display = "inline-block";
        
        // Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        document.getElementById("resultsForm").style.display = "none";

        // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
        logViewToGoogleSheet(studentCode, data.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨?.Ø§Ù„Ø§Ø³Ù… || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", currentApiKey);
      })
      .catch((error) => {
        console.error("Error:", error);
        output.innerHTML = `
          <div class="alert-message">
            <h3>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</h3>
            <p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>
            <p>${error.message}</p>
          </div>
        `;
        document.getElementById("savePdfButton").style.display = "none";
      });
  });

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© - Ø¨Ø¯ÙˆÙ† Ø¹Ù†Ø§ÙˆÙŠÙ†
  function createSubjectsTable(subjectsData, resultType) {
    let tableHeader = "";
    let tableRows = "";

    // ØªØ­Ø¯ÙŠØ¯ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    if (resultType === "API_Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…") {
      tableHeader = `
        <div class="no-title"></div>
        <div class="subjects-table-container">
          <table class="subjects-table">
            <thead>
              <tr>
                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                <th>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</th>
                <th>Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      for (const [subject, grades] of Object.entries(subjectsData)) {
        const total = grades.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ || 0;
        const gradeClass = getGradeClass(total, 100);
        
        tableRows += `<tr>
          <td class="subject-name">${subject}</td>
          <td class="${getGradeClass(grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø£ÙˆÙ„Ù‰, 50)}">${grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø£ÙˆÙ„Ù‰ || "0"}</td>
          <td class="${getGradeClass(grades.Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…, 50)}">${grades.Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù… || "0"}</td>
          <td class="${gradeClass}">${total}</td>
        </tr>`;
      }
    } 
    else if (resultType === "API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…") {
      tableHeader = `
        <div class="no-title"></div>
        <div class="subjects-table-container">
          <table class="subjects-table">
            <thead>
              <tr>
                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                <th>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</th>
                <th>Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù…</th>
                <th>Ø§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</th>
                <th>Ø¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      for (const [subject, grades] of Object.entries(subjectsData)) {
        const total = grades.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ || 0;
        const gradeClass = getGradeClass(total, 100);
        
        tableRows += `<tr>
          <td class="subject-name">${subject}</td>
          <td class="${getGradeClass(grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø£ÙˆÙ„Ù‰, 25)}">${grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø£ÙˆÙ„Ù‰ || "0"}</td>
          <td class="${getGradeClass(grades.Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…, 25)}">${grades.Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù… || "0"}</td>
          <td class="${getGradeClass(grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø«Ø§Ù†ÙŠØ©, 25)}">${grades.Ø§Ù„Ù…Ø­ØµÙ„Ø©_Ø§Ù„Ø«Ø§Ù†ÙŠØ© || "0"}</td>
          <td class="${getGradeClass(grades.Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…, 25)}">${grades.Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù… || "0"}</td>
          <td class="${gradeClass}">${total}</td>
        </tr>`;
      }
    } 
    else {
      tableHeader = `
        <div class="no-title"></div>
        <div class="subjects-table-container">
          <table class="subjects-table">
            <thead>
              <tr>
                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                <th>Ø´ÙÙ‡ÙŠ</th>
                <th>ÙˆØ§Ø¬Ø¨Ø§Øª</th>
                <th>Ù…ÙˆØ§Ø¸Ø¨Ø©</th>
                <th>ØªØ­Ø±ÙŠØ±ÙŠ</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      for (const [subject, grades] of Object.entries(subjectsData)) {
        const total = grades.Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ || 0;
        const gradeClass = getGradeClass(total, 50);
        
        tableRows += `<tr>
          <td class="subject-name">${subject}</td>
          <td class="${getGradeClass(grades.Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª, 10)}">${grades.Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª || "0"}</td>
          <td class="${getGradeClass(grades.Ø´ÙÙ‡ÙŠ, 15)}">${grades.Ø´ÙÙ‡ÙŠ || "0"}</td>
           <td class="${getGradeClass(grades.Ù…ÙˆØ§Ø¸Ø¨Ø©, 10)}">${grades.Ù…ÙˆØ§Ø¸Ø¨Ø© || "0"}</td>
          <td class="${getGradeClass(grades.ØªØ­Ø±ÙŠØ±ÙŠ, 15)}">${grades.ØªØ­Ø±ÙŠØ±ÙŠ || "0"}</td>
          <td class="${gradeClass}">${total}</td>
        </tr>`;
      }
    }

    return tableHeader + tableRows + `</tbody></table></div>`;
  }

  // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø§Ù„Ø¯Ø±Ø¬Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø©
  function getGradeClass(value, maxValue) {
    if (!value || isNaN(value)) return "";
    
    const percentage = (parseFloat(value) / maxValue) * 100;
    
    if (percentage >= 80) return "grade-high";
    if (percentage >= 50) return "grade-medium";
    return "grade-low";
  }

  // Ø¯Ø§Ù„Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
  function logViewToGoogleSheet(studentCode, studentName, resultType) {
    // Ø±Ø§Ø¨Ø· API Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
    const logApiUrl = "https://script.google.com/macros/s/AKfycbwFDDVvBR88pPpEUPhfnqpPNaqRWp3BCUkOc2BwAKB7Nwc802hV_Ojzp7V9e--RPxlY/exec";
    
    const logData = {
      studentCode: studentCode,
      studentName: studentName,
      resultType: resultType,
      viewDate: new Date().toISOString(),
      action: "ØªÙ… Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©"
    };

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ³Ø¬ÙŠÙ„Ù‡Ø§
    fetch(logApiUrl, {
      method: "POST",
      body: JSON.stringify(logData)
    })
    .then(response => response.json())
    .then(data => {
      console.log("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­:", data);
    })
    .catch(error => {
      console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶:", error);
    });
  }

  // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒÙ€ PDF
  document.getElementById("savePdfButton").addEventListener("click", function() {
    const element = document.getElementById("resultsOutput");
    const studentName = currentStudentData?.Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ø§Ù„Ø¨?.Ø§Ù„Ø§Ø³Ù… || "Ø·Ø§Ù„Ø¨";
    const resultType = getResultTypeName(currentApiKey);
    
    const options = {
      margin: [5, 5, 5, 5],
      filename: `Ù†ØªÙŠØ¬Ø©_${studentName}_${resultType}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { 
        scale: 2,
        useCORS: true,
        logging: false,
        windowWidth: 850
      },
      jsPDF: { 
        unit: 'mm', 
        format: 'a4', 
        orientation: 'portrait'
      }
    };

    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
    const printContainer = document.createElement('div');
    printContainer.style.padding = '5px';
    printContainer.style.maxWidth = '800px';
    printContainer.style.margin = '0 auto';
    
    // Ù†Ø³Ø® Ø§Ù„Ø±Ø£Ø³
    const header = document.querySelector('header').cloneNode(true);
    header.style.borderBottom = '1px solid #000';
    header.style.marginBottom = '10px';
    header.style.padding = '5px';
    printContainer.appendChild(header);
    
    // Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    const resultsClone = element.cloneNode(true);
    
    // ØªØ·Ø¨ÙŠÙ‚ ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø©
    const style = document.createElement('style');
    style.textContent = `
      @media print {
        .student-info { 
          border: 1px solid #000 !important;
          padding: 5px !important;
          margin-bottom: 8px !important;
        }
        .subjects-table { 
          border: 1px solid #000 !important;
          font-size: 9px !important;
        }
        .subjects-table th { 
          padding: 4px 3px !important;
          height: 18px !important;
        }
        .subjects-table td { 
          padding: 3px 3px !important;
          height: 18px !important;
        }
        .final-results { 
          border: 1px solid #000 !important;
          padding: 8px !important;
          margin-top: 10px !important;
        }
        .student-info h3 { font-size: 0.9em !important; }
        .info-label { font-size: 0.75em !important; }
        .info-value { font-size: 0.85em !important; }
        .final-results h3 { font-size: 1em !important; }
        .final-result-label { font-size: 0.75em !important; }
        .final-result-value { font-size: 1.1em !important; }
        .result-status { font-size: 0.9em !important; }
      }
    `;
    printContainer.appendChild(style);
    printContainer.appendChild(resultsClone);
    
    html2pdf().from(printContainer).set(options).save();
  });

  // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
  function getResultTypeName(apiKey) {
    const typeNames = {
      "API_Ù…Ø­Ø±Ù…": "Ù…Ø­Ø±Ù…",
      "API_ØµÙØ±": "ØµÙØ±",
      "API_Ø±Ø¨ÙŠØ¹_Ø§ÙˆÙ„": "Ø±Ø¨ÙŠØ¹_Ø£ÙˆÙ„",
      "API_Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…": "Ù†ØµÙ_Ø§Ù„Ø¹Ø§Ù…",
      "API_Ø¬Ù…Ø§Ø¯_Ø§ÙˆÙ„": "Ø¬Ù…Ø§Ø¯_Ø£ÙˆÙ„",
      "API_Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ": "Ø¬Ù…Ø§Ø¯_Ø«Ø§Ù†ÙŠ",
      "API_Ø±Ø¬Ø¨": "Ø±Ø¬Ø¨",
      "API_Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…": "Ø¢Ø®Ø±_Ø§Ù„Ø¹Ø§Ù…"
    };
    
    return typeNames[apiKey] || "Ù†ØªÙŠØ¬Ø©";
  }
</script>

</html>